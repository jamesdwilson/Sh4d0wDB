{
  "id": "memory-shadowdb",
  "kind": "memory",
  "uiHints": {
    "connectionString": {
      "label": "PostgreSQL Connection String",
      "sensitive": true,
      "placeholder": "postgresql://user:pass@host:5432/shadow",
      "help": "PG connection URL. Falls back to ~/.shadowdb.json if omitted."
    },
    "embedding.provider": {
      "label": "Embedding Provider",
      "placeholder": "ollama",
      "help": "ollama | openai | openai-compatible | voyage | gemini | command"
    },
    "embedding.model": {
      "label": "Embedding Model",
      "placeholder": "nomic-embed-text",
      "help": "Model name for selected provider"
    },
    "embedding.dimensions": {
      "label": "Embedding Dimensions",
      "help": "Must match existing vector column dimensions (default: 768)"
    },
    "embedding.apiKey": {
      "label": "Embedding API Key",
      "sensitive": true,
      "placeholder": "key...",
      "help": "Used for openai/openai-compatible/voyage/gemini providers"
    },
    "embedding.baseUrl": {
      "label": "Provider Base URL",
      "placeholder": "https://api.openai.com",
      "help": "Optional base URL override (OpenAI-compatible, Voyage, Gemini)"
    },
    "embedding.headers": {
      "label": "Extra Headers",
      "help": "Optional extra headers sent with embedding requests"
    },
    "embedding.ollamaUrl": {
      "label": "Ollama URL",
      "placeholder": "http://localhost:11434",
      "help": "Ollama API endpoint (default: http://localhost:11434)"
    },
    "embedding.voyageInputType": {
      "label": "Voyage Input Type",
      "help": "query or document"
    },
    "embedding.geminiTaskType": {
      "label": "Gemini Task Type",
      "help": "Example: RETRIEVAL_QUERY"
    },
    "embedding.command": {
      "label": "Embedding Command",
      "help": "For provider=command. Command receives JSON on stdin and must return JSON embedding"
    },
    "embedding.commandArgs": {
      "label": "Embedding Command Args",
      "help": "Optional argv list for embedding.command"
    },
    "embedding.commandTimeoutMs": {
      "label": "Embedding Command Timeout (ms)",
      "help": "Timeout for provider=command (default: 15000)"
    },
    "table": {
      "label": "Table Name",
      "placeholder": "memories",
      "help": "PG table with content + embedding columns"
    },
    "writes.enabled": {
      "label": "Write Operations Enabled",
      "help": "Master gate for memory_write, memory_update, memory_delete tools (default: false)"
    },
    "writes.autoEmbed": {
      "label": "Auto-Embed on Write",
      "help": "Generate embedding automatically on write/update (default: true)"
    },
    "writes.retention.purgeAfterDays": {
      "label": "Retention: Purge After Days",
      "help": "Permanently remove soft-deleted records after N days (default: 30, 0 = never)"
    },
    "primer.enabled": {
      "label": "Primer Injection Enabled",
      "help": "Inject primer identity/rules context from DB before runs (default: true)"
    },
    "primer.mode": {
      "label": "Primer Injection Mode",
      "help": "always | first-run | digest (default: always)"
    },
    "primer.maxChars": {
      "label": "Primer Max Chars",
      "help": "Max characters injected from primer records per hydration (default: 4000)"
    },
    "primer.cacheTtlMs": {
      "label": "Primer Digest Cache TTL (ms)",
      "help": "For mode=digest, reinject after TTL even if digest unchanged (default: 600000)"
    },
    "primer.maxCharsByModel": {
      "label": "Model-Aware Max Chars",
      "help": "Map of model substring patterns to maxChars overrides. First match wins, falls back to primer.maxChars."
    }
  },
  "configSchema": {
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "backend": {
        "type": "string",
        "enum": ["postgres", "sqlite", "mysql"],
        "description": "Database backend: postgres (default), sqlite (zero-config), or mysql (9.2+)"
      },
      "connectionString": {
        "type": "string",
        "description": "Connection string (Postgres/MySQL) or file path (SQLite). Falls back to ~/.shadowdb.json if omitted."
      },
      "configPath": {
        "type": "string",
        "description": "Path to ~/.shadowdb.json (default: ~/.shadowdb.json)"
      },
      "embedding": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "provider": {
            "type": "string",
            "enum": [
              "ollama",
              "openai",
              "openai-compatible",
              "voyage",
              "gemini",
              "command"
            ],
            "description": "Embedding provider"
          },
          "apiKey": {
            "type": "string"
          },
          "model": {
            "type": "string"
          },
          "dimensions": {
            "type": "number"
          },
          "ollamaUrl": {
            "type": "string",
            "description": "Ollama API endpoint (default: http://localhost:11434)"
          },
          "baseUrl": {
            "type": "string",
            "description": "Provider base URL override"
          },
          "headers": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          },
          "voyageInputType": {
            "type": "string",
            "enum": [
              "query",
              "document"
            ]
          },
          "geminiTaskType": {
            "type": "string"
          },
          "command": {
            "type": "string"
          },
          "commandArgs": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "commandTimeoutMs": {
            "type": "number"
          }
        }
      },
      "table": {
        "type": "string"
      },
      "search": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "maxResults": {
            "type": "number"
          },
          "minScore": {
            "type": "number"
          },
          "vectorWeight": {
            "type": "number"
          },
          "textWeight": {
            "type": "number"
          },
          "recencyWeight": {
            "type": "number",
            "description": "Weight for recency in RRF ranking. Small value = tiebreaker only. Default: 0.15"
          }
        }
      },
      "writes": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "enabled": {
            "type": "boolean",
            "description": "Master gate for write tools (memory_write, memory_update, memory_delete). Default: false."
          },
          "autoEmbed": {
            "type": "boolean",
            "description": "Auto-generate embedding on write/update. Default: true."
          },
          "retention": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "purgeAfterDays": {
                "type": "number",
                "description": "Permanently remove soft-deleted records after N days (default: 30, 0 = never)"
              }
            }
          }
        }
      },
      "primer": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "enabled": {
            "type": "boolean"
          },
          "mode": {
            "type": "string",
            "enum": [
              "always",
              "first-run",
              "digest"
            ]
          },
          "maxChars": {
            "type": "number"
          },
          "cacheTtlMs": {
            "type": "number"
          },
          "maxCharsByModel": {
            "type": "object",
            "description": "Model substring -> maxChars overrides. First matching pattern wins.",
            "additionalProperties": {
              "type": "number"
            }
          }
        }
      }
    }
  }
}
